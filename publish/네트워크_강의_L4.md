## TCP UDP 개요
- TCP : 연결 개념이 존재한다. 
- UDP : 연결 개념이 존재하지 않는다. 
-> 연결은 상당히 논리적(Virtual)이다. 
- TCP의 연결은 결과적으로 순서번호로 구현된다. 
- 연결은 '상태' 개념은 동반한다. 


### TCP
- Client 와 Server로 이루어진다. 
1. PID를 가진 프로세스가 소켓을 생성해서 클라이언트에서 오픈한다. 
2. 운영체제에서 Socket에 TCP Port 번호를 부여한다. 
3. 서버 컴퓨터는 소켈을 listening하고 있고 연결을 대기하고 있다. 

[[express.js]]에서 listen하고 있었는데 그 이유인가? 


### UDP
- 소켓 통신도 같고 Port번호도 동일. 

## TCP 연결 과정 (3-way handshaking)
![[TCP 연결 과정.excalidraw.png]]
- TCP 연결 이란 정책 교환하는 것이다. 
정책 교환 안에 난수 번호와 여러가지가 있고 중요한게 MSS 사이즈가 포함된다. 연결은 현재 논리적인 것이라 Virtual하다는 것이라는 것 이해해야한다. 


## TCP 연결 종료 과정 (4-way handshaking)
![[TCP 연결 종료 과정.excalidraw.png]]


## TCP Header 형식 
포트번호는 0부터 65535까지 사용할 수 있다. 하지만 포트 번호 0과 65535는 사용할 수가 없다. 

- 정해진 port (well-known port )
1. web : tcp 80번 


### TCP Header 형식 
![[Pasted image 20230504125604.png]]

- window size : 여분의 공간 (여유공간)
- checksum : 손상된 데이터가 있는지 검사 값

### UDP Header 형식
TCP보다 단순한 UDP 헤드 형식 
![[Pasted image 20230504125749.png]]

티비 영상 송출할 경우 모두를 고려하면 네트워크 손실이 크기에 UDP를 사용한다. 

#문제 TCP로 게임 서버 동기화를 하게 되면 하향평준화가 되어버린다. 그래서 UDP로 게임서버간의 구현을 많이 하게 된다. 

#암기 UDP 는 멀티미디어 데이터 전송에 최적화되어 있는 프로토콜 


## TCP '연결'이라는 착각
Q. 파일 다운로드 중 LAN 케이블이 분리하고 다시 연결하면 어떻게 될까? 


결과는? 
1. TCP 연결은 유지된다? 
-> RFC 문서에서는 

- OS 단에서 재전송 타이머는 1초 미만이다.
- 재전송 타이머 만료 후에도 확인 응답을 받지 못한 경우 세그먼트를 재전송하고 RTO 값은 두 배로 증가한다. 
- 보통 최대 5회 재전송을 시도하고 5회 이상 모두 실패할 경우 보통 전송 오류가 발생한다. 

## TCP 연결과 게임 버그 
- 어떤 MMORPG 게임에서 **아이템 복제버그**가 발생했다.
- 이는 논리적 TCP 연결과 물리적 링크간 차이를 이용한 시간차 공격이라고 할 수 있고 연결이 사실 End-point의 주관적 판단에 불과하다는 것을 보여준다.
-> 연결이 **주관적 판단에 불과한 착각**이다.

TCP의 연결과는 보안성이 없다는 말이 따라붙는다. 연결은 신뢰할 수 없다. 

### 보안의 3대 요소
1. 기밀 (비밀)
2. 무결 (변조)
3. 가용 